local cbrxTSLs = {}

cbrxTSLs["CIVILIZATION_BABYLON"] = {X = 9, Y = 0, S = "F", O = "F"} --Observer--
cbrxTSLs["CIVILIZATION_JFD_AFGHANISTAN_DURRANI"] = {X = 56, Y = 50, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_JFD_EGYPT_AKHENATEN"] = {X = 34, Y = 43, S = "F", O = "F"}
--cbrxTSLs["CIVILIZATION_MC_KILWA"] = {X = 40, Y = 20, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_ASQ_SANGAMPANDYA"] = {X = 66, Y = 32, S = "F", O = "F"}
--cbrxTSLs["CIVILIZATION_URD_YEMEN"] = {X = 42, Y = 37, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_UC_TURKEY"] = {X = 37, Y = 56, S = "F", O = "F"}
--cbrxTSLs["CIVILIZATION_GT_PERM"] = {X = 54, Y = 77, S = "F", O = "F"}
--cbrxTSLs["CIVILIZATION_JFD_KHAZARIA"] = {X = 46, Y = 64, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_GT_GOKTURKS"] = {X = 76, Y = 75, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_JFD_ANGLO_NORSE"] = {X = 21, Y = 72, S = "T", O = "F"}
cbrxTSLs["CIVILIZATION_THP_ZULU"] = {X = 37, Y = 10, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_THP_SEN_TUVA"] = {X = 71, Y = 78, S = "F", O = "F"}
--cbrxTSLs["CIVILIZATION_DJ_PHILIPPINES_AGUINALDO"] = {X = 92, Y = 45, S = "T", O = "T"}
cbrxTSLs["CIVILIZATION_SAS_VERMONT"] = {X = 151, Y = 74, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_UC_CENTRAL_AMERICA"] = {X = 135, Y = 47, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_JFD_AMERICA_F_ROOSEVELT"] = {X = 147, Y = 67, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_US_BRANDENBURG"] = {X = 20, Y = 67, S = "F", O = "F"}
--cbrxTSLs["CIVILIZATION_JFD_LITHUANIA"] = {X = 31, Y = 71, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_SENSHI_GREENLAND"] = {X = 158, Y = 85, S = "T", O = "T"}
cbrxTSLs["CIVILIZATION_SAS_UGANDA"] = {X = 37, Y = 28, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_SAS_CHAD"] = {X = 28, Y = 32, S = "F", O = "F"}
--cbrxTSLs["CIVILIZATION_SAS_MOHAVE"] = {X = 124, Y = 63, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_JWW_COMANCHE"] = {X = 130, Y = 63, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_JFD_CASTILE"] = {X = 9, Y = 50, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_JWW_ANGOLA"] = {X = 28, Y = 17, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_PG_RIODELAPLATA"] = {X = 154, Y = 17, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_SENSHI_YUGOSLAVIA"] = {X = 27, Y = 58, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_UC_BEST_KOREA"] = {X = 92, Y = 70, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_SAS_MODOC"] = {X = 121, Y = 69, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_UC_SEMINOLE"] = {X = 144, Y = 58, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_US_IRELAND"] = {X = 3, Y = 69, S = "T", O = "T"}
cbrxTSLs["CIVILIZATION_PB_MORI"] = {X = 97, Y = 65, S = "T", O = "F"}
cbrxTSLs["CIVILIZATION_MUISCA"] = {X = 145, Y = 42, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_SENSHI_CAMBODIA"] = {X = 83, Y = 39, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_TCM_KIEV"] = {X = 34, Y = 65, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_ERW_KOKANG"] = {X = 79, Y = 49, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_JFD_BRAZIL_PEDRO_I"] = {X = 161, Y = 25, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_JFD_MAORI_POTATAU"] = {X = 117, Y = 13, S = "T", O = "T"}
cbrxTSLs["CIVILIZATION_THECREEFIRSTNATION"] = {X = 129, Y = 80, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_ASQ_ARAPAHO"] = {X = 129, Y = 71, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_GPUZ_KAYAPO"] = {X = 156, Y = 33, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_TRANQ_NORMANS"] = {X = 24, Y = 52, S = "T", O = "F"}
cbrxTSLs["CIVILIZATION_CHILE_ALLENDE"] = {X = 146, Y = 18, S = "F", O = "F"}
--cbrxTSLs["CIVILIZATION_TCM_ASSYRIA"] = {X = 45, Y = 52, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_JWW_TETOUAN"] = {X = 9, Y = 45, S = "T", O = "F"}
cbrxTSLs["CIVILIZATION_DMS_BOTSWANA"] = {X = 32, Y = 12, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_LITE_AINU"] = {X = 101, Y = 79, S = "T", O = "T"}
cbrxTSLs["CIVILIZATION_ERJAR_BENGAL"] = {X = 70, Y = 49, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_SENSHI_INDONESIA"] = {X = 85, Y = 25, S = "T", O = "T"}
cbrxTSLs["CIVILIZATION_MALI_SUNDIATA"] = {X = 12, Y = 32, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_GT_QOCHO"] = {X = 73, Y = 69, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_TCM_MASSAGETAE"] = {X = 56, Y = 65, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_MC_INCA"] = {X = 145, Y = 29, S = "T", O = "F"}
cbrxTSLs["CIVILIZATION_JFD_VLADIMIR"] = {X = 40, Y = 72, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_SPLATDAY_DUTCH"] = {X = 14, Y = 66, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_URD_KWAK"] = {X = 118, Y = 79, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_AUSTRALIA_LS_MOD"] = {X = 108, Y = 12, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_ER_YOLNGU"] = {X = 99, Y = 25, S = "T", O = "F"}
cbrxTSLs["CIVILIZATION_JFD_HAN_WU"] = {X = 80, Y = 64, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_JWW_TIMOR-LESTE"] = {X = 94, Y = 26, S = "T", O = "T"}
cbrxTSLs["CIVILIZATION_JFD_GREAT_MING_YONGLE"] = {X = 88, Y = 60, S = "F", O = "F"}

local observerTechs = {GameInfoTypes["TECH_SAILING"].ID ,GameInfoTypes["TECH_POTTERY"].ID, GameInfoTypes["TECH_TRAPPING"].ID, GameInfoTypes["TECH_MINING"].ID, GameInfoTypes["TECH_AGRICULTURE"].ID, GameInfoTypes["TECH_ARCHERY"].ID}
-- Pottery, Animal Husbandry, Mining, Calendar, Masonry, Compass
-- local observerTechs = {1, 2, 4, 6, 10, 25}
local optics = GameInfoTypes["TECH_OPTICS"]
local galley = GameInfoTypes["UNIT_GALLEY"].ID

function addSailing(iPlayer)
	if Game.GetGameTurn() > 2 then return end
	local player = Players[iPlayer]
	if not player then return end
	local sCivilizationType = GameInfo.Civilizations[player:GetCivilizationType()].Type
	if not sCivilizationType then return end
	if not cbrxTSLs[sCivilizationType] then return end

	for v in player:Units() do
		if v:GetUnitType() == 0 then
			v:SetXY(cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
		end
	end

	local pTeam = Teams[player:GetTeam()]

	if cbrxTSLs[sCivilizationType].S == "T" then
		player:InitUnit(galley, cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
		pTeam:SetHasTech(optics, true)
		player:InitUnit(1, cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
	end
end
GameEvents.PlayerDoTurn.Add(addSailing)

function setTSLs()
	if Game.GetGameTurn() > 2 then return end
	for iPlayer = 0, GameDefines.MAX_MAJOR_CIVS - 1, 1 do
		local player = Players[iPlayer]
		if not player then return end
		local sCivilizationType = GameInfo.Civilizations[player:GetCivilizationType()].Type
		local pTeam = Teams[player:GetTeam()]
		local currentTeamID = pTeam:GetID()

		if iPlayer == 0 then
			for index, val in ipairs(observerTechs) do
				pTeam:SetHasTech(val, true)
			end
		end

		for i = 0, Map.GetNumPlots() - 1, 1 do
			local plot = Map.GetPlotByIndex(i)
			local oldVisibility = plot:GetVisibilityCount(currentTeamID)

			if oldVisibility > 0 then
				plot:ChangeVisibilityCount(currentTeamID, -1, -1, true, true)
				plot:SetRevealed(currentTeamID, false)
				plot:UpdateFog()
			end
		end
		Game.UpdateFOW(true)
		UI.RequestMinimapBroadcast()

		if cbrxTSLs[sCivilizationType] then
			print(sCivilizationType)
			for v in player:Units() do
				v:SetXY(cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
			end

			player:InitUnit(1, cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
			player:InitUnit(81, cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)

			if cbrxTSLs[sCivilizationType].O == "T" then
				local worker = false

				player:InitUnit(galley, cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
				player:InitUnit(galley, cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)

				for u in player:Units() do
					if u:GetUnitType() == 83 then
						local newTrireme = player:InitUnit(22, u:GetX(), u:GetY())
						newTrireme:JumpToNearestValidPlot()
						u:Kill()
					elseif u:GetUnitType() == 1 and (cbrxTSLs[sCivilizationType].S == "T" or worker == false) then
						local newWorkBoat = player:InitUnit(2, u:GetX(), u:GetY())
						newWorkBoat:JumpToNearestValidPlot()
						u:Kill()
						worker = true
					end
				end
			end
		end
	end
end
Events.SequenceGameInitComplete.Add(setTSLs)